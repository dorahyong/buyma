<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oneblocks.domain.common.repository.BuymaRepository">
    <insert id="upsertToken">
        INSERT INTO buyma.buyma_tokens (id, access_token, refresh_token, updated_at)
        VALUES (1, #{accessToken}, #{refreshToken}, NOW())
        ON DUPLICATE KEY UPDATE
                             access_token = #{accessToken},
                             refresh_token = #{refreshToken},
                             updated_at = NOW()
    </insert>

    <select id="selectLatestToken" resultType="string">
        SELECT access_token FROM buyma.buyma_tokens WHERE id = 1
    </select>



    <select id="selectAceProductsAll" resultType="map">
        SELECT
            id, reference_number, name, brand_id, category_id,
            sales_price_jpy, main_model_id
        FROM buyma.ace_products limit 1
    </select>

    <select id="selectAceOptionsByRef" resultType="map">
        SELECT
            type, value, master_id, position, sub_model_id
        FROM buyma.ace_product_options
        WHERE product_ref = #{referenceNumber}
        ORDER BY position ASC
    </select>

    <update id="updateWebhookResult">
        UPDATE buyma.ace_products
        SET
            buyma_product_id = #{buymaProductId},
            registration_status = #{status},
            last_error_msg = #{errorMsg}
        WHERE reference_number = #{refNum}
    </update>
</mapper>